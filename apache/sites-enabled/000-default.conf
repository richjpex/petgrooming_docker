# ----------------------------------------------------------------------
# 1. HTTP Virtual Host (Port 80) - Used to Redirect to HTTPS
# ----------------------------------------------------------------------
<VirtualHost *:80>
    ServerName localhost
    # Redirect all HTTP requests to HTTPS on the same host
    Redirect permanent / https://localhost/
</VirtualHost>


# ----------------------------------------------------------------------
# 2. HTTPS Virtual Host (Port 443) - Secure Connection
# ----------------------------------------------------------------------
# Listen on the standard HTTPS port
Listen 443 https

<VirtualHost *:443>
    ServerName localhost
    # DocumentRoot must match the application code mount point
    DocumentRoot /var/www/html/pet_grooming 

    # --- PHP FPM Handler ---
    # Tells Apache to forward requests for .php files to the PHP-FPM engine
    # Assumes PHP-FPM is running on port 9000 on localhost within the same container.
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://localhost:9000"
    </FilesMatch>
    
    # --- SSL Configuration ---
    SSLEngine on
    # Paths inside the container where certificates were mounted from ./apache/certs
    SSLCertificateFile      /etc/apache2/ssl/server.crt
    SSLCertificateKeyFile   /etc/apache2/ssl/server.key
    # Add security enhancements (optional but recommended)
    SSLProtocol all -SSLv2 -SSLv3
    SSLCipherSuite HIGH:!aNULL:!MD5
    # --- End SSL Configuration ---

    # Directory access rules
    <Directory /var/www/html/pet_grooming>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>